<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Firebase Chat</title>
  <style>
    :root{--bg:#f5f7fb;--card:#fff;--accent:#4f46e5;--muted:#6b7280}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:var(--bg); margin:0;display:flex;align-items:center;justify-content:center;height:100vh}
    .app{width:420px;background:var(--card);border-radius:12px;box-shadow:0 6px 24px rgba(16,24,40,0.08);overflow:hidden}
    header{padding:16px 20px;border-bottom:1px solid #eef2ff;display:flex;align-items:center;gap:12px}
    header h1{font-size:16px;margin:0}
    main{padding:12px;height:420px;display:flex;flex-direction:column}
    .messages{flex:1;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
    .msg{max-width:80%;padding:10px 12px;border-radius:10px;background:#f3f4f6;align-self:flex-start}
    .msg.me{background:linear-gradient(90deg,#eef2ff,#e0e7ff);align-self:flex-end}
    .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
    .composer{display:flex;gap:8px;padding:12px;border-top:1px solid #f3f4f6}
    input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid #e6e9f2;outline:none}
    button{background:var(--accent);color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    .small{font-size:12px;color:var(--muted);padding:8px 12px}
    .top-controls{display:flex;gap:8px;align-items:center;margin-left:auto}
    .name-input{width:140px;padding:6px;border-radius:8px;border:1px solid #e6e9f2}
    .status{font-size:12px;color:var(--muted);padding:8px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div style="width:36px;height:36px;background:linear-gradient(45deg,#c7d2fe,#60a5fa);border-radius:8px"></div>
      <h1>Firebase Chat</h1>
      <div class="top-controls">
        <input class="name-input" id="displayName" placeholder="Your name (optional)" />
        <div id="authStatus" class="small">Connecting...</div>
      </div>
    </header>

    <main>
      <div id="messages" class="messages"></div>
      <div class="composer">
        <input id="messageInput" type="text" placeholder="Type a message and press Enter" />
        <button id="sendBtn">Send</button>
      </div>
      <div class="small" style="text-align:center">This demo uses Firebase Realtime Database. Replace the firebaseConfig placeholders with your project values.</div>
    </main>
  </div>

  <!-- Firebase (compat) SDKs from CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    // ---------------------------
    // Configuration - edit these
    // ---------------------------
    // The user provided apiKey has been inserted below. To run this app you should replace
    // the placeholders (authDomain, databaseURL, projectId, etc.) with the values from your
    // Firebase project settings. If you only have an apiKey for now, create a Firebase project
    // and copy the full config from the project settings.
    const firebaseConfig = {
      apiKey: "AIzaSyD0T-mS__FlN3QASJnmD0K6S5VNDiN2bxQ",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // UI elements
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    const nameInput = document.getElementById('displayName');
    const authStatus = document.getElementById('authStatus');

    // Reader that ensures newest messages show at bottom
    function scrollToBottom(){ messagesEl.scrollTop = messagesEl.scrollHeight; }

    // Simple message renderer
    function renderMessage(data){
      const msg = data.val();
      const el = document.createElement('div');
      el.className = 'msg' + (msg.uid === currentUid ? ' me' : '');

      const meta = document.createElement('div');
      meta.className = 'meta';
      const when = new Date(msg.ts || Date.now());
      meta.textContent = `${msg.name || 'Anonymous'} â€¢ ${when.toLocaleTimeString()}`;

      const body = document.createElement('div');
      body.textContent = msg.text || '';

      el.appendChild(meta);
      el.appendChild(body);
      messagesEl.appendChild(el);
      scrollToBottom();
    }

    // Authentication: anonymous sign-in
    let currentUid = null;
    auth.signInAnonymously().catch(err => console.error(err));

    auth.onAuthStateChanged(user => {
      if(user){
        currentUid = user.uid;
        authStatus.textContent = 'Connected (anonymous)';
        startListening();
      } else {
        authStatus.textContent = 'Not signed in';
      }
    });

    // Listen for new messages
    let messagesRef = db.ref('messages');
    function startListening(){
      messagesRef.limitToLast(200).on('child_added', snap => renderMessage(snap));
    }

    // Send a message
    function sendMessage(){
      const text = inputEl.value.trim();
      if(!text) return;

      const name = (nameInput.value || 'Anonymous').trim();
      const msg = {
        uid: currentUid,
        name: name || 'Anonymous',
        text: text,
        ts: Date.now()
      };

      // push to realtime db
      messagesRef.push(msg).then(()=>{
        inputEl.value = '';
        inputEl.focus();
      }).catch(err=>{
        console.error('Send failed', err);
        alert('Failed to send message. Check console for details.');
      });
    }

    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keydown', e=>{ if(e.key === 'Enter') sendMessage(); });

    // Persist display name locally
    nameInput.addEventListener('change', ()=> localStorage.setItem('chat_name', nameInput.value));
    (function(){ const stored = localStorage.getItem('chat_name'); if(stored) nameInput.value = stored; })();

    // Simple cleanup button (uncomment if you want to wipe messages from console)
    // function wipe(){ messagesRef.remove(); }
  </script>
</body>
</html>

