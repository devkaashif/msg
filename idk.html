<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Text Sharing â€” Firebase (Demo)</title>
  <style>
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;color:#111}
    body{max-width:900px;margin:28px auto;padding:20px}
    h1{font-size:20px;margin:0 0 6px}
    p.lead{margin:0 0 18px;color:#444}
    .card{border:1px solid #e6e6e6;border-radius:8px;padding:12px;margin-bottom:12px;background:#fff}
    textarea{width:100%;min-height:120px;padding:8px;font-size:14px;border-radius:6px;border:1px solid #ddd}
    input[type=text]{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd}
    .row{display:flex;gap:8px}
    .btn{display:inline-block;padding:8px 12px;border-radius:6px;border:0;background:#0b74de;color:white;cursor:pointer}
    .btn.ghost{background:#f3f3f3;color:#111}
    .meta{font-size:12px;color:#666;margin-top:6px}
    .note{white-space:pre-wrap}
    .controls{display:flex;gap:6px;align-items:center}
    .small{font-size:13px;color:#666}
    .notes-wrap{margin-top:18px}
    .note-item{padding:10px;border-radius:8px;border:1px solid #eee;margin-bottom:10px}
    .muted{color:#777;font-size:12px}
  </style>
</head>
<body>
  <h1>Live Text Sharing (Demo)</h1>
  <p class="lead">Write text and share it. Other visitors will see updates instantly.</p>

  <div class="card">
    <label class="small">Your name (optional)</label>
    <input id="displayName" type="text" placeholder="e.g. Alice" />
    <label class="small" style="margin-top:8px;display:block">Message</label>
    <textarea id="message" placeholder="Type something to share live..."></textarea>
    <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
      <button id="sendBtn" class="btn">Share</button>
      <button id="clearBtn" class="btn ghost">Clear</button>
      <div id="status" class="muted" style="margin-left:auto">Connecting...</div>
    </div>
  </div>

  <div class="notes-wrap">
    <h2 style="font-size:16px;margin-bottom:8px">Live Messages</h2>
    <div id="notes" aria-live="polite"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <!--
    IMPORTANT: I used your provided apiKey below and left placeholders for the other
    Firebase config values. Replace the placeholders (the values that start with PLACEHOLDER_)
    with the values from your Firebase project settings (in the Firebase console).

    If you have a full firebaseConfig object already, you can paste it here and keep apiKey as provided.
  -->
  <script>
    // ----- Firebase config (fill in your project values) -----
    const firebaseConfig = {
      apiKey: "AIzaSyD0T-mS__FlN3QASJnmD0K6S5VNDiN2bxQ",
      authDomain: "PLACEHOLDER_YOUR_AUTH_DOMAIN.firebaseapp.com",
      databaseURL: "https://PLACEHOLDER_YOUR_DATABASE_NAME-default-rtdb.firebaseio.com",
      projectId: "PLACEHOLDER_PROJECT_ID",
      storageBucket: "PLACEHOLDER_PROJECT_ID.appspot.com",
      messagingSenderId: "PLACEHOLDER_MESSAGING_SENDER_ID",
      appId: "PLACEHOLDER_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // DOM refs
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const messageEl = document.getElementById('message');
    const notesEl = document.getElementById('notes');
    const statusEl = document.getElementById('status');
    const nameEl = document.getElementById('displayName');

    // Path in Realtime Database where notes will be stored
    const NOTES_PATH = 'live_messages';

    // Sign in anonymously so we have a uid for ownership checks
    auth.signInAnonymously().catch(err => {
      console.error('Auth error', err);
      statusEl.textContent = 'Auth error: ' + err.message;
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        statusEl.textContent = 'Connected as ' + (user.isAnonymous ? 'anonymous' : (user.displayName || user.email));
        window.currentUid = user.uid;
        startListening();
      } else {
        statusEl.textContent = 'Not signed in';
      }
    });

    // Send message (create a new child under NOTES_PATH)
    sendBtn.addEventListener('click', () => {
      const text = messageEl.value && messageEl.value.trim();
      if (!text) return alert('Please type a message first');

      const payload = {
        text,
        name: nameEl.value ? nameEl.value.trim() : 'Anonymous',
        uid: window.currentUid || null,
        ts: Date.now()
      };

      // push() creates a unique key and writes data
      db.ref(NOTES_PATH).push(payload)
        .then(() => {
          messageEl.value = '';
        })
        .catch(err => {
          console.error('Write error', err);
          alert('Failed to share: ' + err.message);
        });
    });

    // Clear textarea
    clearBtn.addEventListener('click', () => messageEl.value = '');

    // Render helper
    function renderNote(key, noteData) {
      const existing = document.getElementById(key);
      if (noteData === null) {
        // removed
        if (existing) existing.remove();
        return;
      }

      const el = existing || document.createElement('div');
      el.className = 'note-item';
      el.id = key;

      const time = new Date(noteData.ts || Date.now()).toLocaleString();

      let controlsHtml = '';
      if (noteData.uid && window.currentUid && noteData.uid === window.currentUid) {
        controlsHtml = ` <button data-key="${key}" class="btn ghost" data-action="delete">Delete</button>`;
      }

      el.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <div style="font-weight:600">${escapeHtml(noteData.name || 'Anonymous')}</div>
            <div class="muted" style="margin-top:4px">${time}</div>
          </div>
          <div class="controls">${controlsHtml}</div>
        </div>
        <div class="note" style="margin-top:8px">${escapeHtml(noteData.text)}</div>
      `;

      // attach listeners for delete
      const delBtn = el.querySelector('[data-action="delete"]');
      if (delBtn) {
        delBtn.onclick = () => {
          if (!confirm('Delete this message?')) return;
          db.ref(`${NOTES_PATH}/${key}`).remove().catch(err => alert('Remove failed: ' + err.message));
        };
      }

      if (!existing) notesEl.prepend(el); // newest on top
    }

    // Start listening for live updates
    let listening = false;
    function startListening() {
      if (listening) return;
      listening = true;
      const ref = db.ref(NOTES_PATH);

      // initial set and child_added
      ref.on('child_added', snapshot => renderNote(snapshot.key, snapshot.val()));
      ref.on('child_changed', snapshot => renderNote(snapshot.key, snapshot.val()));
      ref.on('child_removed', snapshot => renderNote(snapshot.key, null));

      // optional: connection state monitoring
      const connectedRef = db.ref('.info/connected');
      connectedRef.on('value', snap => {
        const connected = snap.val();
        statusEl.textContent = connected ? 'Online' : 'Offline';
      });
    }

    // helper: escape HTML to avoid injection in demo
    function escapeHtml(str){
      if (str == null) return '';
      return String(str)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#039;');
    }

    // Optional: keep list small in UI by limiting number of items loaded
    // (Could implement paging or history trimming on the server)
  </script>

  <!--
    Quick setup notes (put these in your Firebase console):

    1) Realtime Database: create a database and copy the databaseURL into firebaseConfig.databaseURL
       e.g. https://your-db-name-default-rtdb.firebaseio.com

    2) Security rules for quick testing (NOT for production):

       {
         "rules": {
           ".read": true,
           ".write": true
         }
       }

       For production, restrict write permissions or require authentication.

    3) If you prefer Firestore instead of Realtime Database, let me know and I will give
       a Firestore version of this single-file app.
  -->
</body>
</html>
