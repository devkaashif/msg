<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multiplayer Arena (HTML + Firebase)</title>
  <style>
    :root{--bg:#0f1724;--panel:#111827;--accent:#38bdf8;--muted:#94a3b8}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{background:linear-gradient(180deg,#071021 0%, #0b1220 100%);color:#e6eef8;display:flex;align-items:center;justify-content:center}
    .app{width:980px;max-width:98vw;height:680px;max-height:96vh;background:rgba(255,255,255,0.03);border-radius:12px;padding:16px;box-sizing:border-box;display:grid;grid-template-columns:320px 1fr;gap:12px}
    .panel{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;backdrop-filter:blur(6px)}
    .left{display:flex;flex-direction:column;gap:10px}
    label{font-size:13px;color:var(--muted)}
    input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{padding:10px;border-radius:8px;border:0;background:var(--accent);color:#042028;font-weight:600;cursor:pointer}
    #canvasWrap{position:relative;height:100%;border-radius:10px;overflow:hidden}
    canvas{width:100%;height:100%;display:block;background:linear-gradient(180deg,#05202b 0%, #042034 100%)}
    .playersList{max-height:200px;overflow:auto;padding:6px;border-radius:8px;background:rgba(255,255,255,0.01)}
    .playerItem{padding:6px;border-radius:6px;margin-bottom:6px;background:rgba(0,0,0,0.12);display:flex;justify-content:space-between}
    .controls{display:flex;gap:8px}
    .hint{font-size:12px;color:var(--muted)}
    .joystick{position:absolute;left:16px;bottom:16px;width:120px;height:120px;border-radius:50%;pointer-events:none}
    .touchPad{position:absolute;right:16px;bottom:24px;width:120px;height:120px;border-radius:8px;pointer-events:none}
    @media (max-width:800px){.app{grid-template-columns:1fr;grid-template-rows:auto 1fr;height:98vh}}
  </style>
</head>
<body>
  <div class="app">
    <div class="panel left">
      <div>
        <label>Player name</label>
        <input id="nameInput" type="text" placeholder="Your name" />
      </div>

      <div>
        <label>Room ID (shared with friends)</label>
        <input id="roomInput" type="text" placeholder="room-123" />
      </div>

      <div class="controls">
        <button id="joinBtn">Join Room</button>
        <button id="leaveBtn" disabled>Leave</button>
      </div>

      <div style="margin-top:8px">
        <label>Players in room</label>
        <div class="playersList" id="playersList">(none)</div>
      </div>

      <div style="margin-top:8px">
        <label>Game controls</label>
        <div class="hint">Desktop: WASD / Arrow keys. Mobile: touch anywhere and drag to move.</div>
      </div>

      <div style="margin-top:auto">
        <label>Notes</label>
        <div class="hint">This demo uses Firebase Realtime Database. For testing set DB rules to true (not for production). Replace placeholders in the firebaseConfig below with your project's values. The provided apiKey has already been inserted.</div>
      </div>
    </div>

    <div class="panel" id="canvasWrap">
      <canvas id="gameCanvas"></canvas>
      <div class="joystick" id="joystick" style="display:none"></div>
    </div>
  </div>

  <!-- Firebase (compat) libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
  // ----------------------
  // CONFIG: insert your project details
  // ----------------------
  const firebaseConfig = {
    apiKey: "AIzaSyD0T-mS__FlN3QASJnmD0K6S5VNDiN2bxQ",
    authDomain: "YOUR_PROJECT.firebaseapp.com",         // replace
    databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com", // replace
    projectId: "YOUR_PROJECT",                         // replace
    storageBucket: "YOUR_PROJECT.appspot.com",        // replace
    messagingSenderId: "SENDER_ID",                  // replace
    appId: "APP_ID"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Simple multiplayer: each client writes its player state to /rooms/{roomId}/players/{playerId}

  // --- Local game state ---
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  let W = canvas.width = canvas.clientWidth;
  let H = canvas.height = canvas.clientHeight;

  function resize() {
    W = canvas.width = canvas.clientWidth;
    H = canvas.height = canvas.clientHeight;
  }
  window.addEventListener('resize', resize);

  // Player controlled state
  const local = {
    id: null,
    name: 'Player',
    x: Math.random()*800 + 50,
    y: Math.random()*400 + 50,
    color: '#'+Math.floor(Math.random()*16777215).toString(16),
    vx:0,vy:0,
    speed: 160 // pixels per second
  }

  let roomId = null;
  let players = {}; // other players states

  // DOM
  const nameInput = document.getElementById('nameInput');
  const roomInput = document.getElementById('roomInput');
  const joinBtn = document.getElementById('joinBtn');
  const leaveBtn = document.getElementById('leaveBtn');
  const playersList = document.getElementById('playersList');

  nameInput.value = 'Player'+Math.floor(Math.random()*9000);

  joinBtn.addEventListener('click', joinRoom);
  leaveBtn.addEventListener('click', leaveRoom);

  function joinRoom(){
    if(!roomInput.value) roomInput.value = 'room-1';
    roomId = roomInput.value.trim();
    local.name = nameInput.value || local.name;
    local.id = 'p_'+Math.random().toString(36).slice(2,9);

    // write presence and state
    const playerRef = db.ref(`rooms/${roomId}/players/${local.id}`);
    playerRef.set({
      name: local.name, x: local.x, y: local.y, color: local.color, ts: firebase.database.ServerValue.TIMESTAMP
    });
    // remove on disconnect
    playerRef.onDisconnect().remove();

    // listen to players
    db.ref(`rooms/${roomId}/players`).on('value', snapshot => {
      const val = snapshot.val() || {};
      players = val;
      // ensure local player exists in local object
      playersList.innerHTML = '';
      for(const pid in players){
        const p = players[pid];
        const item = document.createElement('div');
        item.className = 'playerItem';
        item.innerHTML = `<div>${p.name||pid}</div><div style="opacity:0.8">${pid===local.id? 'you' : 'online'}</div>`;
        playersList.appendChild(item);
      }
    });

    joinBtn.disabled = true; leaveBtn.disabled = false;
  }

  function leaveRoom(){
    if(!roomId || !local.id) return;
    db.ref(`rooms/${roomId}/players/${local.id}`).remove();
    db.ref(`rooms/${roomId}/players`).off();
    players = {};
    playersList.innerHTML = '(none)';
    joinBtn.disabled = false; leaveBtn.disabled = true;
    roomId = null; local.id = null;
  }

  // Input handling (desktop + mobile)
  const keys = {};
  window.addEventListener('keydown', e=>{keys[e.key]=true});
  window.addEventListener('keyup', e=>{keys[e.key]=false});

  let touchStart = null;
  function getTouchVector(e){
    const t = e.touches ? e.touches[0] : e;
    return {x: t.clientX - canvas.getBoundingClientRect().left, y: t.clientY - canvas.getBoundingClientRect().top};
  }
  canvas.addEventListener('touchstart', e=>{ e.preventDefault(); touchStart = getTouchVector(e);});
  canvas.addEventListener('touchmove', e=>{ e.preventDefault(); const tv = getTouchVector(e); const dx = tv.x - touchStart.x; const dy = tv.y - touchStart.y; local.vx = dx; local.vy = dy; });
  canvas.addEventListener('touchend', e=>{ touchStart = null; local.vx=0; local.vy=0; });

  // Also allow mouse drag
  let mouseDown = false; let mouseStart=null;
  canvas.addEventListener('mousedown', e=>{ mouseDown=true; mouseStart = {x:e.offsetX,y:e.offsetY}; });
  canvas.addEventListener('mousemove', e=>{ if(!mouseDown) return; const dx = e.offsetX - mouseStart.x; const dy = e.offsetY - mouseStart.y; local.vx = dx; local.vy = dy; });
  window.addEventListener('mouseup', ()=>{ mouseDown=false; local.vx=0; local.vy=0; });

  // Game loop
  let last = performance.now();
  function tick(now){
    const dt = (now-last)/1000; last = now;
    update(dt);
    render();
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  function update(dt){
    // keyboard
    let mx=0,my=0;
    if(keys['ArrowUp']||keys['w']||keys['W']) my -= 1;
    if(keys['ArrowDown']||keys['s']||keys['S']) my += 1;
    if(keys['ArrowLeft']||keys['a']||keys['A']) mx -= 1;
    if(keys['ArrowRight']||keys['d']||keys['D']) mx += 1;

    // normalize
    if(mx!==0 || my!==0){
      const len = Math.hypot(mx,my)||1; mx/=len; my/=len;
      local.x += mx*local.speed*dt;
      local.y += my*local.speed*dt;
    }

    // touch/mouse velocity style control
    if(local.vx || local.vy){
      const len = Math.hypot(local.vx, local.vy) || 1;
      const nx = local.vx/len, ny = local.vy/len;
      local.x += nx * Math.min(300, len) * dt;
      local.y += ny * Math.min(300, len) * dt;
    }

    // clamp to canvas
    local.x = Math.max(16, Math.min(W-16, local.x));
    local.y = Math.max(16, Math.min(H-16, local.y));

    // write to firebase (throttle)
    const nowMs = Date.now();
    if(roomId && local.id){
      // small throttle: write every 100ms
      if(!local._lastSync || nowMs - local._lastSync > 100){
        local._lastSync = nowMs;
        db.ref(`rooms/${roomId}/players/${local.id}`).update({ x: local.x, y: local.y, color: local.color, name: local.name, ts: firebase.database.ServerValue.TIMESTAMP});
      }
    }
  }

  function render(){
    ctx.clearRect(0,0,W,H);

    // background grid
    ctx.save();
    ctx.globalAlpha = 0.08;
    ctx.beginPath();
    for(let gx=0;gx<W;gx+=40){ ctx.moveTo(gx,0); ctx.lineTo(gx,H); }
    for(let gy=0;gy<H;gy+=40){ ctx.moveTo(0,gy); ctx.lineTo(W,gy); }
    ctx.strokeStyle = '#fff'; ctx.stroke();
    ctx.restore();

    // draw players
    // players object contains all player states; make sure to draw local player last
    for(const pid in players){
      if(pid===local.id) continue;
      const p = players[pid];
      if(!p) continue;
      drawPlayer(p.x||0,p.y||0,p.color||'#888',p.name||pid,false);
    }
    // draw local player
    drawPlayer(local.x, local.y, local.color, local.name, true);
  }

  function drawPlayer(x,y,color,name,isLocal){
    ctx.save();
    ctx.beginPath();
    ctx.fillStyle = color || '#8bd';
    ctx.strokeStyle = '#00000033';
    ctx.lineWidth = 2;
    ctx.arc(x,y,16,0,Math.PI*2);
    ctx.fill();
    ctx.stroke();
    ctx.closePath();

    // name tag
    ctx.font = '13px system-ui,Arial';
    ctx.fillStyle = '#e6eef8';
    ctx.textAlign = 'center';
    ctx.fillText(name, x, y-22);

    if(isLocal){
      // small indicator
      ctx.beginPath(); ctx.arc(x+10,y-10,6,0,Math.PI*2); ctx.fillStyle = '#ffffff33'; ctx.fill();
    }
    ctx.restore();
  }

  // initial canvas sizing
  setTimeout(resize,50);

  // quick helper: enable DB rules for testing
  // In your Firebase console: Realtime Database -> Rules -> set to:
  // {
  //   "rules": {
  //     ".read": true,
  //     ".write": true
  //   }
  // }

  // That's it. Share the room ID with friends. Each client who joins the same room will see each other's dots in near-real-time.
  </script>
</body>
</html>
